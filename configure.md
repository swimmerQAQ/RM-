# 能进正赛就算成功队

先上cubemx的配置图<img src="C:\Users\86156\Desktop\2021RM校内赛\rm校内赛。电控\1621701897(1).png" alt="1621701897(1)" style="zoom:50%;" />

![1621701897(1)](C:\Users\86156\Desktop\2021RM校内赛\rm校内赛。电控\1621701897(1).png)

![1621702036(1)](C:\Users\86156\Desktop\2021RM校内赛\rm校内赛。电控\1621702036(1).png)

TIM 1-3 和5 用作encoder编码器计数，可以测得电机当前的转速

参数设置0xFFFF是由此数开始计数，发生溢出，简单理解就是每次触发一次重载值为0xFFFF，加一自然就溢出了变为0

（不难看出，由于GPIO的引脚占用，对于F407VET6，PA0和1的冲突，我们选择使用GPIO的readpin功能也能实现，{ timx_ic_callback函数输入检测触发（注意滤波），简单实现encoder就好 }）

#### 驱动部分

<img src="C:\Users\86156\Desktop\2021RM校内赛\rm校内赛。电控\1621702756(1).png" alt="1621702756(1)" style="zoom:50%;" />

TIM4 直接输出四路pwm作为驱动pwm控制

# GPIO

<img src="C:\Users\86156\Desktop\2021RM校内赛\rm校内赛。电控\1621703197(1).png" alt="1621703197(1)" style="zoom: 50%;" />

<img src="C:\Users\86156\Desktop\2021RM校内赛\rm校内赛。电控\1621703210(1).png" alt="1621703210(1)" style="zoom:60%;" />

这部分比较多，不过很容易理解

通过阅读标签

> > > > > > > > > > > >  R是read：循迹接受（10路）

> > > > > > > >
> > > > > > > > CS CLK DI DO ：ps2 的接受引脚口（用于遥控车子
> > > > > > > >
> > > > > > > > spi总线协议：总开关，时基（最重要），数据的输入输出
> > > >
> > > > AF BF AR BR 四个轮子（forth and rear）
> > > >
> > > > 使用的是tb6612驱动电机

给定pwm和前后转动就可以控制小车的轮子啦！

TIM8——9

两个定时器用于舵机的驱动，共有三路pwm，用于机械臂的控制

夹取uarm的两条臂，以及小车自转，使得拥有四个自由度

#驱动底层结束#